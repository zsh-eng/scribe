---
import type { Section } from '../lib/db';

interface Props {
  section: Section;
  showSpeakers?: boolean;
}

const { section, showSpeakers = true } = Astro.props;

const typeLabels: Record<string, string> = {
  'OA': 'Oral Answer',
  'WA': 'Written Answer',
  'WANA': 'Written Answer (No Answer)',
  'OS': 'Oral Statement',
  'WS': 'Written Statement',
};

const typeColors: Record<string, string> = {
  'OA': 'bg-blue-100 text-blue-700',
  'WA': 'bg-purple-100 text-purple-700',
  'WANA': 'bg-zinc-100 text-zinc-700',
  'OS': 'bg-amber-100 text-amber-700',
  'WS': 'bg-amber-100 text-amber-700',
};

const categoryLabels: Record<string, string> = {
  'motion': 'Motion',
  'adjournment_motion': 'Adjournment Motion',
  'clarification': 'Clarification',
  'statement': 'Statement',
};

const categoryColors: Record<string, string> = {
  'motion': 'bg-indigo-100 text-indigo-700',
  'adjournment_motion': 'bg-indigo-100 text-indigo-700',
  'clarification': 'bg-amber-100 text-amber-700',
  'statement': 'bg-amber-100 text-amber-700',
};

const typeLabel = section.category && categoryLabels[section.category]
  ? categoryLabels[section.category]
  : typeLabels[section.sectionType] || section.sectionType;

const typeColor = section.category && categoryColors[section.category]
  ? categoryColors[section.category]
  : typeColors[section.sectionType] || 'bg-zinc-100 text-zinc-700';

const formattedDate = section.sessionDate
  ? new Date(section.sessionDate).toLocaleDateString('en-SG', {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
    })
  : null;

const snippet = section.contentPlain?.substring(0, 150) + (section.contentPlain && section.contentPlain.length > 150 ? '...' : '');
---

<a
  href={`/questions/${section.id}`}
  class="block rounded-lg border border-zinc-200 bg-white p-4 transition-all hover:border-blue-300 hover:shadow-md"
>
  <div class="mb-2 flex flex-wrap items-center gap-2">
    <span class={`rounded px-2 py-0.5 text-xs font-medium ${typeColor}`}>
      {typeLabel}
    </span>
    {section.ministry && (
      <span class="rounded bg-green-100 px-2 py-0.5 text-xs font-medium text-green-700">
        {section.ministry}
      </span>
    )}
    {formattedDate && (
      <span class="text-xs text-zinc-500">
        {formattedDate}
      </span>
    )}
  </div>
  <h3 class="mb-2 line-clamp-2 font-semibold text-zinc-900">
    {section.sectionTitle}
  </h3>
  {showSpeakers && section.speakers && section.speakers.length > 0 && (
    <div class="mb-2 flex flex-wrap gap-1">
      {section.speakers.slice(0, 3).map((speaker) => (
        <span class="text-xs text-blue-600">
          {speaker.name}
        </span>
      ))}
      {section.speakers.length > 3 && (
        <span class="text-xs text-zinc-500">+{section.speakers.length - 3} more</span>
      )}
    </div>
  )}
  {snippet && (
    <p class="text-sm text-zinc-600 line-clamp-2">
      {snippet}
    </p>
  )}
</a>
